"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,a){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,a){var n=_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(a):i.value}})(t,e,a||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var a=[],n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done)&&(a.push(r.value),!e||a.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function initAnimations(t){t.ANIMATION_TYPE_LINEAR=0,t.ANIMATION_TYPE_EASE=1,t.ANIMATION_TYPE_EASE_IN=2,t.ANIMATION_TYPE_EASE_OUT=3,t.isAnimated=!1,t.lastLoop=(new Date).getTime(),t.animationCallback=function(){},t.cancelAnimation=function(){this.isAnimated=!1},t.startAnimation=function(e){this.isAnimated=!0,this.animationCallback=e,t.lastLoop=(new Date).getTime(),this.loop()},t.loop=function(){if(this.isAnimated){var t=this.lastLoop;this.lastLoop=(new Date).getTime();var e=this.lastLoop-t;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.animationCallback(e,this),requestAnimationFrame(this.loop.bind(this))}};var e=function(t,e){return t/e},a=function(t,e){return(1+Math.cos(Math.PI+Math.PI*t/e))/2},n=function(t,e){return 1+Math.cos(Math.PI+Math.PI*t/e/2)},i=function(t,e){return Math.sin(Math.PI*t/e/2)},o=function o(r,s,h,c){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new Date).getTime(),u=(new Date).getTime();if((r+=u-l)>=s)c(1);else{var d=0;switch(h){case t.ANIMATION_TYPE_LINEAR:d=e(r,s);break;case t.ANIMATION_TYPE_EASE:d=a(r,s);break;case t.ANIMATION_TYPE_EASE_IN:d=n(r,s);break;case t.ANIMATION_TYPE_EASE_OUT:d=i(r,s)}c(d),requestAnimationFrame((function(){return o(r,s,h,c,u)}))}};t.partialAnimation=function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.ANIMATION_TYPE_LINEAR;o(0,e,n,a)}}function initFunctionDrawing(t){t.drawFunction=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.xFrom||0,i=void 0===a.xTo?t.canvas.width:a.xTo,o=a.yFrom||0,r=void 0===a.yTo?t.canvas.height:a.yTo,s=a.fill,h=a.lineWidth||1;this.beginPath();for(var c=0;c<this.canvas.width;c++){var l=n+c/this.canvas.width*(i-n),u=(e(l)-o)/(r-o)*this.canvas.height;console.log(e(l),o,r,this.canvas.height),this.fillRect(c,this.canvas.height-u,1,s?u:h)}this.closePath()},t.drawRadialFunction=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.xFrom||0,i=void 0===a.xTo?t.canvas.width/2:a.xTo,o=a.yFrom||0,r=void 0===a.yTo?t.canvas.height/2:a.yTo,s=a.fill,h=a.lineWidth||1,c=void 0===a.centerX?t.canvas.width/2:a.centerX,l=void 0===a.centerY?t.canvas.height/2:a.centerY;this.beginPath();for(var u=0;u<=2*Math.PI;u+=.01){var d=(e(u)-n)/(i-n)*Math.cos(u)*this.canvas.width/2+c,f=(e(u)-o)/(r-o)*Math.sin(u)*this.canvas.height/2+l;0===u?this.moveTo(d,f):this.lineTo(d,f)}t.lineWidth=h,s?this.fill():this.stroke(),this.closePath()},t.drawFuriesSeries=function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.depth||100;this.drawFunction((function(n){for(var o=t,r=0;r<i;r++)o+=e(r)*Math.cos(n*r)+a(r)*Math.sin(n*r);return o}),n)},t.polynomialRegression=function(t,e){var a=t.length,n=_toConsumableArray(t),i=_toConsumableArray(e);return function(t){for(var e=_toConsumableArray(n),o=_toConsumableArray(i),r=1;r<a;r++)for(var s=0;s<a-r;s++)o[s]=((t-e[s+r])*o[s]+(e[s]-t)*o[s+1])/(e[s]-e[s+r]);return o[0]}},t.drawDataPolynomial=function(t,e,a){this.drawFunction(this.polynomialRegression(t,e),a)},t.drawColors=function(e,a){var n=a.xFrom||0,i=void 0===a.xTo?t.canvas.width:a.xTo,o=a.yFrom||0,r=void 0===a.yTo?t.canvas.height:a.yTo,s=a.brightness||function(t,e){return 1/(1+1/Math.pow(Math.pow(t,2)+Math.pow(e,2),.1)*5)};function h(t,e,a){var n,i,o;if(0===e)n=i=o=a;else{var r=function(t,e,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?t+6*(e-t)*a:a<.5?e:a<2/3?t+(e-t)*(2/3-a)*6:t},s=a<.5?a*(1+e):a+e-a*e,h=2*a-s;n=r(h,s,t+1/3),i=r(h,s,t),o=r(h,s,t-1/3)}return[Math.round(255*n),Math.round(255*i),Math.round(255*o)]}for(var c=this.getAllImageData(),l=c.data,u=0;u<this.canvas.width;u++)for(var d=0;d<this.canvas.height;d++){var f=_slicedToArray(e(n+u/this.canvas.width*(i-n),o+d/this.canvas.height*(r-o)),2),v=f[0],g=f[1],m=Math.atan2(g,v)+Math.PI/2;m/=2*Math.PI;var p=s(v,g),y=_slicedToArray(h(m,1,Math.min(p,1)),3),w=y[0],I=y[1],_=y[2],P=u*this.canvas.width*4+4*d;l[P]=w,l[P+1]=I,l[P+2]=_,l[P+3]=255}this.putImageData(c,0,0)}}function initHotSpot(t){t.addHotSpot=function(t,e){return new(window[t[0].toUpperCase()+t.substring(1).toLowerCase()+"HotSpot"])(this,e)}}HTMLCanvasElement.prototype.getCustomContext=function(){var t=this.getContext("2d");return t?(initImageDrawing(t),initFunctionDrawing(t),initShapesDrawing(t),initAnimations(t),initHotSpot(t),initRecord(t),t.downloadURL=function(t,e){var a=document.createElement("a");a.style="display: none",a.href=t,a.download=e,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t)},t.download=function(t){var e=this.toDataURL();this.downloadURL(e,t)},t.getAllImageData=function(){return this.getImageData(0,0,this.canvas.width,this.canvas.height)},t.clearAll=function(){return this.clearRect(0,0,this.canvas.width,this.canvas.height),this},t.fillAll=function(){this.beginPath(),this.fillRect(0,0,this.canvas.width,this.canvas.height),this.closePath()},t.circle=function(t,e,a){this.beginPath(),this.arc(t,e,a,0,2*Math.PI),this.fill(),this.closePath()},t.flipVertical=function(){var t=this;this.replacePixelsBy((function(e,a){return{newRow:t.canvas.height-e,newCol:a}}))},t.flipHorizontal=function(){var t=this;this.replacePixelsBy((function(e,a){return{newRow:e,newCol:t.canvas.width-a}}))},t.getIndexPosition=function(t){var e=t%this.canvas.width;return{row:(t-e)/this.canvas.width,col:e}},t.replacePixelsBy=function(t){for(var e=this.getAllImageData(),a=_toConsumableArray(e.data),n=0;n<this.canvas.width*this.canvas.height;n++)for(var i=this.getIndexPosition(n),o=t(i.row,i.col),r=o.newRow,s=o.newCol,h=this.canvas.width*r*4+4*s,c=4*n,l=0;l<4;l++)e.data[h+l]=a[c+l];this.putImageData(e,0,0)},t.circleLight=function(t,e,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],this.getAllImageData()),o=i.data,r=t-a;r<t+a;r++)for(var s=e-a;s<e+a;s++)for(var h=0;h<4;h++)o[4*r+s*this.canvas.width*4+h]*=1+(a-mathTools.distance(r,s,t,e)>=0?(1-mathTools.distance(r,s,t,e)/a)*n:0);this.putImageData(i,0,0)},t.fillRectRotated=function(e,a,n,i,o){t.beginPath(),t.translate(e+n/2,a+i/2),t.rotate(o),t.fillRect(-n/2,-i/2,n,i),t.closePath()},t.filterImage=function(t){return new ImageFilter(this,t)},t):null};var HotSpot=function(){function t(e,a){var n=this;_classCallCheck(this,t),this.ctx=e,this.options=a,this.listeners={},this.mouseIn=!1,this.ctx.canvas.addEventListener("click",(function(t){var e=n.getXY(t,n.ctx),a=e.X,i=e.Y;n.listeners.click&&n.isIn(a,i)&&n.listeners.click(t)})),this.ctx.canvas.addEventListener("mousemove",(function(t){var e=n.getXY(t,n.ctx),a=e.X,i=e.Y;n.isIn(a,i)?(!1!==n.options.pointOnHover&&(n.ctx.canvas.style.cursor="pointer"),n.listeners.mousemove&&n.listeners.mousemove(t),!n.mouseIn&&n.listeners.mouseenter&&n.listeners.mouseenter(t),n.mouseIn=!0):(!1!==n.options.pointOnHover&&(n.ctx.canvas.style.cursor=""),n.mouseIn&&n.listeners.mouseleave&&n.listeners.mouseleave(t),n.mouseIn=!1)}))}return _createClass(t,[{key:"isIn",value:function(t,e){return!1}},{key:"draw",value:function(){return this}},{key:"getXY",value:function(t,e){return{X:t.offsetX*e.canvas.width/e.canvas.offsetWidth,Y:t.offsetY*e.canvas.height/e.canvas.offsetHeight}}},{key:"remove",value:function(){return this.listeners={},this}},{key:"on",value:function(t,e){return this.listeners[t]=e,this}},{key:"debug",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"red";this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=t;for(var e=0;e<canvas.width;e++)for(var a=0;a<canvas.height;a++)this.isIn(e,a)&&this.ctx.fillRect(e,a,1,1);return this.ctx.closePath(),this.ctx.restore(),this}}]),t}(),RectHotSpot=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,HotSpot),_createClass(e,[{key:"isIn",value:function(t,e){var a=this.options,n=a.x,i=a.y,o=a.width,r=a.height,s=a.rotate,h=n+o/2,c=i+r/2,l=mathTools.rotation(t-h,e-c,-(s||0));return l.x+=h,l.y+=c,l.x>n&&l.x<n+o&&l.y>i&&l.y<i+r}},{key:"draw",value:function(){var t=this.options,a=t.x,n=t.y,i=t.width,o=t.height;return this.ctx.fillRect(a,n,i,o),_get(_getPrototypeOf(e.prototype),"draw",this).call(this)}}]),e}(),CircleHotSpot=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,HotSpot),_createClass(e,[{key:"isIn",value:function(t,e){var a=this.options,n=a.cx,i=a.cy,o=a.radius;return mathTools.distance(n,i,t,e)<o}},{key:"draw",value:function(){var t=this.options,a=t.cx,n=t.cy,i=t.radius;return this.ctx.beginPath(),this.ctx.arc(a,n,i,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath(),_get(_getPrototypeOf(e.prototype),"draw",this).call(this)}}]),e}(),PolygonHotSpot=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,HotSpot),_createClass(e,[{key:"isIn",value:function(t,e){var a=this.options,n=a.cx,i=a.cy,o=a.radius,r=a.vertexCount,s=a.rotate,h=(2.5*Math.PI-(s||0)-Math.atan2(t-n,e-i))%(2*Math.PI),c=Math.floor(h*r/Math.PI/2),l=2*Math.PI/r,u=mathTools.degToXY(l*c+(s||0),o),d=mathTools.degToXY(l*(c+1)+(s||0),o),f=mathTools.lineFunc(u.x+n,d.x+n,u.y+i,d.y+i),v=mathTools.lineFunc(n,t,i,e),g=v.m,m=v.a,p=(f.a-m)/(g-f.m),y=g*p+m;return mathTools.distance(n,i,t,e)<mathTools.distance(n,i,p,y)}},{key:"draw",value:function(){var t=this.options,a=t.cx,n=t.cy,i=t.radius,o=t.vertexCount,r=t.rotate;return this.ctx.fillPolygon(a,n,i,o,r),_get(_getPrototypeOf(e.prototype),"draw",this).call(this)}}]),e}(),StarHotSpot=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,HotSpot),_createClass(e,[{key:"isIn",value:function(t,e){var a=this.options,n=a.cx,i=a.cy,o=a.r1,r=a.r2,s=a.vertexCount,h=a.rotate,c=(2.5*Math.PI-(h||0)-Math.atan2(t-n,e-i))%(2*Math.PI),l=Math.floor(c*s/Math.PI),u=Math.PI/s,d=l%2==0?r:o,f=l%2==0?o:r,v=mathTools.degToXY(u*l+(h||0),d),g=mathTools.degToXY(u*(l+1)+(h||0),f),m=mathTools.lineFunc(v.x+n,g.x+n,v.y+i,g.y+i),p=mathTools.lineFunc(n,t,i,e),y=p.m,w=p.a,I=(m.a-w)/(y-m.m),_=y*I+w;return mathTools.distance(n,i,t,e)<mathTools.distance(n,i,I,_)}},{key:"draw",value:function(){var t=this.options,a=t.cx,n=t.cy,i=t.r1,o=t.r2,r=t.vertexCount,s=t.rotate;return this.ctx.fillStar(a,n,i,o,r,s),_get(_getPrototypeOf(e.prototype),"draw",this).call(this)}}]),e}();function initImageDrawing(t){t.loadImage=function(t){return new Promise((function(e,a){var n=new Image;n.src=t,n.onload=function(){n.onload=null,e(n)},n.onerror=function(){a("field to load resource")}}))},t.drawImageUrl=function(t,e,a,n,i,o,r,s,h){var c=this;return new Promise((function(l,u){c.loadImage(t).then((function(t){o?c.drawImage(t,e,a,n,i,o,r,s,h):n?c.drawImage(t,e,a,n,i):c.drawImage(t,e,a),l(t)})).catch((function(t){u(t)}))}))},t.drawCircleImage=function(t,e,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.width,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:t.height;this.save(),this.beginPath(),this.arc(e+n,a+n,n,0,2*Math.PI,!0),this.closePath(),this.clip(),this.drawImage(t,i,o,r,s,e,a,2*n,2*n),this.restore()},t.drawCircleImageUrl=function(t,e,a,n){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;this.loadImage(t).then((function(t){i.drawCircleImage(t,e,a,n,o,r,s||t.width,h||t.height)})).catch((function(){}))},t.loadImageCover=function(t,e,a){var n=this;return new Promise((function(i,o){n.loadImage(t).then((function(t){var r=document.createElement("canvas");r.width=e,r.height=a,r.getCustomContext().drawImageCover(t,0,0,e,a),n.loadImage(r.toDataURL()).then(i).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageCover=function(t,e,a,n,i){var o=t.width/t.height,r=n/i;o>r?this.drawImage(t,(t.width-t.width*r/o)/2,0,t.width*r/o,t.height,e,a,n,i):this.drawImage(t,0,(t.height-t.height*o/r)/2,t.width,t.height*o/r,e,a,n,i)},t.drawImageCoverUrl=function(t,e,a,n,i){var o=this;return this.loadImage(t).then((function(t){o.drawImageCover(t,e,a,n,i)}))},t.loadImageContain=function(t,e,a){var n=this;return new Promise((function(i,o){n.loadImage(t).then((function(t){var r=document.createElement("canvas");r.width=e,r.height=a,r.getCustomContext().drawImageContain(t,0,0,e,a),n.loadImage(r.toDataURL()).then(i).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageContain=function(t,e,a,n,i){var o=t.width/t.height,r=n/i;o>r?this.drawImage(t,e,a+(i-i*r/o)/2,n,i*r/o):this.drawImage(t,e+(n-n*o/r)/2,a,n*o/r,i)},t.drawImageContainUrl=function(t,e,a,n,i){var o=this;return this.loadImage(t).then((function(t){o.drawImageContain(t,e,a,n,i)}))},t.drawRotatesImage=function(t,e){arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.canvas.width,arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.canvas.height},t.straighten=function(t,e){e=(e=(+e+Math.pow(360,2))%360)/180*Math.PI;var a=t.width,n=t.height,i=mathTools.rotation(-a/2,-n/2,e),o=mathTools.rotation(a/2,-n/2,e),r=(mathTools.rotation(-a/2,n/2,e),mathTools.rotation(a/2,n/2,e),mathTools.lineFunc(i.x,o.x,i.y,o.y)),s=r.m,h=r.a,c=n/a,l=h/((c=e%Math.PI<Math.PI/2?-n/a:n/a)-s),u=l*c,d=2*mathTools.distance(l,u),f=Math.atan(n/a),v=d*Math.cos(f),g=d*Math.sin(f),m=document.createElement("canvas"),p=m.getCustomContext();return m.width=a,m.height=n,p.save(),p.beginPath(),p.rect(a/2-v/2,n/2-g/2,v,g),p.clip(),p.translate(a/2,n/2),p.rotate(e),p.drawImage(t,0,0,a,n,-a/2,-n/2,a,n),p.closePath(),p.restore(),new Promise((function(t,e){p.loadImage(m.toDataURL()).then((function(e){p.drawImage(e,a/2-v/2,n/2-g/2,v,g,0,0,m.width,m.height),t(m.toDataURL())})).catch((function(t){return e(t)}))}))},t.straightenUrl=function(t,e){var a=this;return this.loadImage(t).then((function(t){return a.straighten(t,e)}))},t.opacityMask=function(t){var e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;var a=e.getCustomContext();a.drawImage(t,0,0,e.width,e.height);for(var n=a.getAllImageData().data,i=this.getAllImageData(),o=0;o<n.length;o+=4)i.data[o+3]=n[o+3];this.putImageData(i,0,0)},t.opacityMaskUrl=function(t){var e=this;this.loadImage(t).then((function(t){e.opacityMask(t)}))}}function ImageFilter(t,e){var a=this;this.ctx=t,this.img=e,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=e.width,this.mCanvas.height=e.height,this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.drawImage(e,0,0),this.imagedata=this.mCtx.getImageData(0,0,this.mCanvas.width,this.mCanvas.height),this.data=this.imagedata.data,this.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.img.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.img.height,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.ctx.canvas.width,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a.ctx.canvas.height;a.ctx.drawImageUrl(a.url(),o,r,s,h,t,e,n,i)},this.url=function(){return a.mCtx.putImageData(a.imagedata,0,0),a.mCanvas.toDataURL()},this.grayscale=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<a.data.length;e+=4){var n=(a.data[e]+a.data[e+1]+a.data[e+2])/3;a.data[e]+=(n-a.data[e])*t,a.data[e+1]+=(n-a.data[e+1])*t,a.data[e+2]+=(n-a.data[e+2])*t}return a},this.contrast=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,e=0;e<a.data.length;e+=4)for(var n=0;n<3;n++)a.data[e+n]=2*t*(a.data[e+n]-128)+128;return a},this.mat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75;t/=3;for(var e=0;e<a.data.length;e+=4)for(var n=0;n<3;n++)a.data[e+n]>=128?a.data[e+n]+=t*(255-a.data[e+n]):a.data[e+n]*=1-t;return a},this.brightness=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.25,e=0;e<a.data.length;e+=4)for(var n=0;n<3;n++)a.data[e+n]*=t;return a},this.invert=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<a.data.length;e+=4)for(var n=0;n<3;n++)a.data[e+n]+=(255-2*a.data[e+n])*t;return a},this.r=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<a.data.length;e+=4)a.data[e]*=t;return a},this.g=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=1;e<a.data.length;e+=4)a.data[e]*=t;return a},this.b=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=2;e<a.data.length;e+=4)a.data[e]*=t;return a},this.rgb=function(t,e,n){for(var i=0;i<a.data.length;i+=4)a.data[i]*=t,a.data[i+1]*=e,a.data[i+2]*=n;return a}}var mathTools={distance:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.sqrt(Math.pow(a-t,2)+Math.pow(n-e,2))},rotation:function(t,e,a){return{x:t*Math.cos(a)-e*Math.sin(a),y:t*Math.sin(a)+e*Math.cos(a)}},lineFunc:function(t,e,a,n){var i=(n-a)/(e-t);return{m:i,a:n-e*i}},degToXY:function(t,e){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}};function initRecord(t){t.RECORD_TYPE_BLOB=0,t.RECORD_TYPE_URL=1,t.RECORD_TYPE_DOWNLOAD=2,t._recordedChunks=[],t.startRecord=function(){var t=this,e=this.canvas.captureStream(100),a={bitsPerSecond:5e6};return MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?a.mimeType="video/webm; codecs=vp9":MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?a.mimeType="video/webm; codecs=vp8":console.error("no supported mime found for Media Recorder"),this.mediaRecorder=new MediaRecorder(e,a),this.mediaRecorder.ondataavailable=function(e){e.data.size>0?t._recordedChunks.push(e.data):console.error("record data empty")},this.mediaRecorder.start(500),e},t.stopRecord=function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.RECORD_TYPE_DOWNLOAD;this.mediaRecorder.stop(),setTimeout((function(){var t=new Blob(e._recordedChunks);if(a===e.RECORD_TYPE_BLOB)return t;var n=URL.createObjectURL(t);if(a===e.RECORD_TYPE_URL)return n;a===e.RECORD_TYPE_DOWNLOAD&&e.downloadURL(n,"recorded.webm")}))}}function initShapesDrawing(t){t.drawArrow=function(e,a,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:6;this.beginPath(),this.moveTo(e,a),this.lineTo(n,i),this.stroke(),this.closePath();var s=function(){return n-e},h=function(){return i-a},c=Math.sqrt(Math.pow(s(),2)+Math.pow(h(),2)),l={x:n,y:i},u={x:n-o/c*s(),y:i-o/c*h()},d=h()/s(),f=0;d===1/0?d=0:f=-1/d;var v=r/Math.sqrt(1+Math.pow(f,2)),g={x:u.x+v,y:u.y+f*v},m={x:u.x-v,y:u.y-f*v};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(g.x,g.y),t.lineTo(m.x,m.y),t.lineTo(l.x,l.y),t.fill(),t.closePath()},t.linePolygon=function(t,e,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.moveTo(t+Math.cos(i)*a,e+Math.sin(i)*a);for(var o=1;o<=n;o++)this.lineTo(t+Math.cos(i+o/n*Math.PI*2)*a,e+Math.sin(i+o/n*Math.PI*2)*a)},t.strokePolygon=function(t,e,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,e,a,n,i),this.stroke(),this.closePath()},t.fillPolygon=function(t,e,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,e,a,n,i),this.fill(),this.closePath()},t.lineStar=function(t,e,a,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.moveTo(t+Math.cos(o)*n,e+Math.sin(o)*n);for(var r=1;r<=i;r++){var s=o+(r-.5)/i*Math.PI*2,h=mathTools.degToXY(s,a);this.lineTo(t+h.x,e+h.y),s=o+r/i*Math.PI*2,h=mathTools.degToXY(s,n),this.lineTo(t+h.x,e+h.y)}},t.strokeStar=function(t,e,a,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,e,a,n,i,o),this.stroke(),this.closePath()},t.fillStar=function(t,e,a,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,e,a,n,i,o),this.fill(),this.closePath()}}