"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,n){return!n||"object"!==_typeof(n)&&"function"!=typeof n?_assertThisInitialized(t):n}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&_setPrototypeOf(t,n)}function _setPrototypeOf(t,n){return(_setPrototypeOf=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var a=0;a<n.length;a++){var e=n[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,n,a){return n&&_defineProperties(t.prototype,n),a&&_defineProperties(t,a),t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,a=new Array(t.length);n<t.length;n++)a[n]=t[n];return a}}function initAnimations(t){t.isAnimated=!1,t.lastLoop=(new Date).getTime(),t.animationCallback=function(){},t.cancelAnimation=function(){this.isAnimated=!1},t.startAnimation=function(n){this.isAnimated=!0,this.animationCallback=n,t.lastLoop=(new Date).getTime(),this.loop()},t.loop=function(){if(this.isAnimated){var t=this.lastLoop;this.lastLoop=(new Date).getTime();var n=this.lastLoop-t;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.animationCallback(n,this),requestAnimationFrame(this.loop.bind(this))}}}function initFunctionDrawing(t){t.drawFunction=function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=a.xFrom||0,i=void 0===a.xTo?t.canvas.width:a.xTo,o=a.yFrom||0,r=void 0===a.yTo?t.canvas.height:a.yTo,s=a.fill,h=a.lineWidth||1;this.beginPath();for(var c=0;c<this.canvas.width;c++){var l=e+c/this.canvas.width*(i-e),u=(n(l)-o)/(r-o)*this.canvas.height;this.fillRect(c,this.canvas.height-u,1,s?u:h)}this.closePath()},t.drawRadialFunction=function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=a.xFrom||0,i=void 0===a.xTo?t.canvas.width/2:a.xTo,o=a.yFrom||0,r=void 0===a.yTo?t.canvas.height/2:a.yTo,s=a.fill,h=a.lineWidth||1,c=void 0===a.centerX?t.canvas.width/2:a.centerX,l=void 0===a.centerY?t.canvas.height/2:a.centerY;this.beginPath();for(var u=0;u<=2*Math.PI;u+=.01){var d=(n(u)-e)/(i-e)*Math.cos(u)*this.canvas.width/2+c,g=(n(u)-o)/(r-o)*Math.sin(u)*this.canvas.height/2+l;0===u?this.moveTo(d,g):this.lineTo(d,g)}t.lineWidth=h,s?this.fill():this.stroke(),this.closePath()}}function initHotSpot(t){t.addHotSpot=function(t,n){return new(window[t[0].toUpperCase()+t.substring(1).toLowerCase()+"HotSpot"])(this,n)}}HTMLCanvasElement.prototype.getCustomContext=function(){var t=this.getContext("2d");return t?(initImageDrawing(t),initFunctionDrawing(t),initShapesDrawing(t),initAnimations(t),initHotSpot(t),t.getAllImageData=function(){return this.getImageData(0,0,this.canvas.width,this.canvas.height)},t.clearAllRect=function(){return this.clearRect(0,0,this.canvas.width,this.canvas.height)},t.flipVertical=function(){var t=this;this.replacePixelsBy((function(n,a){return{newRow:t.canvas.height-n,newCol:a}}))},t.flipHorizontal=function(){var t=this;this.replacePixelsBy((function(n,a){return{newRow:n,newCol:t.canvas.width-a}}))},t.getIndexPosition=function(t){var n=t%this.canvas.width;return{row:(t-n)/this.canvas.width,col:n}},t.replacePixelsBy=function(t){for(var n=this.getAllImageData(),a=_toConsumableArray(n.data),e=0;e<this.canvas.width*this.canvas.height;e++)for(var i=this.getIndexPosition(e),o=t(i.row,i.col),r=o.newRow,s=o.newCol,h=this.canvas.width*r*4+4*s,c=4*e,l=0;l<4;l++)n.data[h+l]=a[c+l];this.putImageData(n,0,0)},t.circleLight=function(t,n,a){for(var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],this.getAllImageData()),o=i.data,r=t-a;r<t+a;r++)for(var s=n-a;s<n+a;s++)for(var h=0;h<4;h++)o[4*r+s*this.canvas.width*4+h]*=1+(a-mathTools.distance(r,s,t,n)>=0?(1-mathTools.distance(r,s,t,n)/a)*e:0);this.putImageData(i,0,0)},t.fillRectRotated=function(n,a,e,i,o){t.beginPath(),t.translate(n+e/2,a+i/2),t.rotate(o),t.fillRect(-e/2,-i/2,e,i),t.closePath()},t.filterImage=function(t){return new ImageFilter(this,t)},t):null};var HotSpot=function(){function t(n,a){var e=this;_classCallCheck(this,t),this.ctx=n,this.options=a,this.listeners={},this.mouseIn=!1,this.ctx.canvas.addEventListener("click",(function(t){var n=e.getXY(t,e.ctx),a=n.X,i=n.Y;e.listeners.click&&e.isIn(a,i)&&e.listeners.click(t)})),this.ctx.canvas.addEventListener("mousemove",(function(t){var n=e.getXY(t,e.ctx),a=n.X,i=n.Y;e.isIn(a,i)?(!1!==e.options.pointOnHover&&(e.ctx.canvas.style.cursor="pointer"),e.listeners.mousemove&&e.listeners.mousemove(t),!e.mouseIn&&e.listeners.mouseenter&&e.listeners.mouseenter(t),e.mouseIn=!0):(!1!==e.options.pointOnHover&&(e.ctx.canvas.style.cursor=""),e.mouseIn&&e.listeners.mouseleave&&e.listeners.mouseleave(t),e.mouseIn=!1)}))}return _createClass(t,[{key:"isIn",value:function(t,n){return!1}},{key:"draw",value:function(){return this}},{key:"getXY",value:function(t,n){return{X:t.offsetX*n.canvas.width/n.canvas.offsetWidth,Y:t.offsetY*n.canvas.height/n.canvas.offsetHeight}}},{key:"remove",value:function(){return this.listeners={},this}},{key:"on",value:function(t,n){return this.listeners[t]=n,this}},{key:"debug",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"red";this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=t;for(var n=0;n<canvas.width;n++)for(var a=0;a<canvas.height;a++)this.isIn(n,a)&&this.ctx.fillRect(n,a,1,1);return this.ctx.closePath(),this.ctx.restore(),this}}]),t}(),RectHotSpot=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,HotSpot),_createClass(n,[{key:"isIn",value:function(t,n){var a=this.options,e=a.x,i=a.y,o=a.width,r=a.height,s=a.rotate,h=e+o/2,c=i+r/2,l=mathTools.rotation(t-h,n-c,-(s||0));return l.x+=h,l.y+=c,l.x>e&&l.x<e+o&&l.y>i&&l.y<i+r}}]),n}(),CircleHotSpot=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,HotSpot),_createClass(n,[{key:"isIn",value:function(t,n){var a=this.options,e=a.cx,i=a.cy,o=a.radius;return mathTools.distance(e,i,t,n)<o}}]),n}(),PolygonHotSpot=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,HotSpot),_createClass(n,[{key:"isIn",value:function(t,n){var a=this.options,e=a.cx,i=a.cy,o=a.radius,r=a.vertexCount,s=a.rotate,h=(2.5*Math.PI-(s||0)-Math.atan2(t-e,n-i))%(2*Math.PI),c=Math.floor(h*r/Math.PI/2),l=2*Math.PI/r,u=mathTools.degToXY(l*c+(s||0),o),d=mathTools.degToXY(l*(c+1)+(s||0),o),g=mathTools.lineFunc(u.x+e,d.x+e,u.y+i,d.y+i),v=mathTools.lineFunc(e,t,i,n),f=v.m,m=v.a,w=(g.a-m)/(f-g.m),p=f*w+m;return mathTools.distance(e,i,t,n)<mathTools.distance(e,i,w,p)}}]),n}(),StarHotSpot=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,HotSpot),_createClass(n,[{key:"isIn",value:function(t,n){var a=this.options,e=a.cx,i=a.cy,o=a.r1,r=a.r2,s=a.vertexCount,h=a.rotate,c=(1.5*Math.PI-(h||0)-Math.atan2(t-e,n-i))%(2*Math.PI),l=Math.floor(c*s*2/Math.PI/2),u=2*Math.PI/s/2,d=l%2==0?o:r,g=l%2==0?r:o,v=mathTools.degToXY(u*l+(h||0),d),f=mathTools.degToXY(u*(l+1)+(h||0),g),m=mathTools.lineFunc(v.x+e,f.x+e,v.y+i,f.y+i),w=mathTools.lineFunc(e,t,i,n),p=w.m,y=w.a,I=(m.a-y)/(p-m.m),C=p*I+y;return mathTools.distance(e,i,t,n)<mathTools.distance(e,i,I,C)}}]),n}();function initImageDrawing(t){t.loadImage=function(t){return new Promise((function(n,a){var e=new Image;e.src=t,e.onload=function(){e.onload=null,n(e)},e.onerror=function(){a("field to load resource")}}))},t.drawImageUrl=function(t,n,a,e,i,o,r,s,h){var c=this;return new Promise((function(l,u){c.loadImage(t).then((function(t){o?c.drawImage(t,n,a,e,i,o,r,s,h):e?c.drawImage(t,n,a,e,i):c.drawImage(t,n,a),l(t)})).catch((function(t){u(t)}))}))},t.drawCircleImage=function(t,n,a,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.width,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:t.height;this.save(),this.beginPath(),this.arc(n+e,a+e,e,0,2*Math.PI,!0),this.closePath(),this.clip(),this.drawImage(t,i,o,r,s,n,a,2*e,2*e),this.restore()},t.drawCircleImageUrl=function(t,n,a,e){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;this.loadImage(t).then((function(t){i.drawCircleImage(t,n,a,e,o,r,s||t.width,h||t.height)})).catch((function(){}))},t.loadImageCover=function(t,n,a){var e=this;return new Promise((function(i,o){e.loadImage(t).then((function(t){var r=document.createElement("canvas");r.width=n,r.height=a,r.getCustomContext().drawImageCover(t,0,0,n,a),e.loadImage(r.toDataURL()).then(i).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageCover=function(t,n,a,e,i){var o=t.width/t.height,r=e/i;o>r?this.drawImage(t,(t.width-t.width*r/o)/2,0,t.width*r/o,t.height,n,a,e,i):this.drawImage(t,0,(t.height-t.height*o/r)/2,t.width,t.height*o/r,n,a,e,i)},t.drawImageCoverUrl=function(t,n,a,e,i){var o=this;return this.loadImage(t).then((function(t){o.drawImageCover(t,n,a,e,i)}))},t.loadImageContain=function(t,n,a){var e=this;return new Promise((function(i,o){e.loadImage(t).then((function(t){var r=document.createElement("canvas");r.width=n,r.height=a,r.getCustomContext().drawImageContain(t,0,0,n,a),e.loadImage(r.toDataURL()).then(i).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageContain=function(t,n,a,e,i){var o=t.width/t.height,r=e/i;o>r?this.drawImage(t,n,a+(i-i*r/o)/2,e,i*r/o):this.drawImage(t,n+(e-e*o/r)/2,a,e*o/r,i)},t.drawImageContainUrl=function(t,n,a,e,i){var o=this;return this.loadImage(t).then((function(t){o.drawImageContain(t,n,a,e,i)}))},t.drawRotatesImage=function(t,n){arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.canvas.width,arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.canvas.height},t.straighten=function(t,n){n=(n=(+n+Math.pow(360,2))%360)/180*Math.PI;var a=t.width,e=t.height,i=mathTools.rotation(-a/2,-e/2,n),o=mathTools.rotation(a/2,-e/2,n),r=(mathTools.rotation(-a/2,e/2,n),mathTools.rotation(a/2,e/2,n),mathTools.lineFunc(i.x,o.x,i.y,o.y)),s=r.m,h=r.a,c=e/a,l=h/((c=n%Math.PI<Math.PI/2?-e/a:e/a)-s),u=l*c,d=2*mathTools.distance(l,u),g=Math.atan(e/a),v=d*Math.cos(g),f=d*Math.sin(g),m=document.createElement("canvas"),w=m.getCustomContext();return m.width=a,m.height=e,w.save(),w.beginPath(),w.rect(a/2-v/2,e/2-f/2,v,f),w.clip(),w.translate(a/2,e/2),w.rotate(n),w.drawImage(t,0,0,a,e,-a/2,-e/2,a,e),w.closePath(),w.restore(),new Promise((function(t,n){w.loadImage(m.toDataURL()).then((function(n){w.drawImage(n,a/2-v/2,e/2-f/2,v,f,0,0,m.width,m.height),t(m.toDataURL())})).catch((function(t){return n(t)}))}))},t.straightenUrl=function(t,n){var a=this;return this.loadImage(t).then((function(t){return a.straighten(t,n)}))},t.opacityMask=function(t){var n=document.createElement("canvas");n.width=this.canvas.width,n.height=this.canvas.height;var a=n.getCustomContext();a.drawImage(t,0,0,n.width,n.height);for(var e=a.getAllImageData().data,i=this.getAllImageData(),o=0;o<e.length;o+=4)i.data[o+3]=e[o+3];this.putImageData(i,0,0)},t.opacityMaskUrl=function(t){var n=this;this.loadImage(t).then((function(t){n.opacityMask(t)}))}}function ImageFilter(t,n){var a=this;this.ctx=t,this.img=n,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=n.width,this.mCanvas.height=n.height,this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.drawImage(n,0,0),this.imagedata=this.mCtx.getImageData(0,0,this.mCanvas.width,this.mCanvas.height),this.data=this.imagedata.data,this.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.img.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.img.height,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.ctx.canvas.width,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a.ctx.canvas.height;a.ctx.drawImageUrl(a.url(),o,r,s,h,t,n,e,i)},this.url=function(){return a.mCtx.putImageData(a.imagedata,0,0),a.mCanvas.toDataURL()},this.grayscale=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=0;n<a.data.length;n+=4){var e=(a.data[n]+a.data[n+1]+a.data[n+2])/3;a.data[n]+=(e-a.data[n])*t,a.data[n+1]+=(e-a.data[n+1])*t,a.data[n+2]+=(e-a.data[n+2])*t}return a},this.contrast=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,n=0;n<a.data.length;n+=4)for(var e=0;e<3;e++)a.data[n+e]=2*t*(a.data[n+e]-128)+128;return a},this.mat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75;t/=3;for(var n=0;n<a.data.length;n+=4)for(var e=0;e<3;e++)a.data[n+e]>=128?a.data[n+e]+=t*(255-a.data[n+e]):a.data[n+e]*=1-t;return a},this.brightness=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.25,n=0;n<a.data.length;n+=4)for(var e=0;e<3;e++)a.data[n+e]*=t;return a},this.invert=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=0;n<a.data.length;n+=4)for(var e=0;e<3;e++)a.data[n+e]+=(255-2*a.data[n+e])*t;return a},this.r=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=0;n<a.data.length;n+=4)a.data[n]*=t;return a},this.g=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=1;n<a.data.length;n+=4)a.data[n]*=t;return a},this.b=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=2;n<a.data.length;n+=4)a.data[n]*=t;return a},this.rgb=function(t,n,e){for(var i=0;i<a.data.length;i+=4)a.data[i]*=t,a.data[i+1]*=n,a.data[i+2]*=e;return a}}var mathTools={distance:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.sqrt(Math.pow(a-t,2)+Math.pow(e-n,2))},rotation:function(t,n,a){return{x:t*Math.cos(a)-n*Math.sin(a),y:t*Math.sin(a)+n*Math.cos(a)}},lineFunc:function(t,n,a,e){var i=(e-a)/(n-t);return{m:i,a:e-n*i}},degToXY:function(t,n){return{x:Math.cos(t)*n,y:Math.sin(t)*n}}};function initShapesDrawing(t){t.drawArrow=function(n,a,e,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:6;this.beginPath(),this.moveTo(n,a),this.lineTo(e,i),this.stroke(),this.closePath();var s=function(){return e-n},h=function(){return i-a},c=Math.sqrt(Math.pow(s(),2)+Math.pow(h(),2)),l={x:e,y:i},u={x:e-o/c*s(),y:i-o/c*h()},d=h()/s(),g=0;d===1/0?d=0:g=-1/d;var v=r/Math.sqrt(1+Math.pow(g,2)),f={x:u.x+v,y:u.y+g*v},m={x:u.x-v,y:u.y-g*v};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(f.x,f.y),t.lineTo(m.x,m.y),t.lineTo(l.x,l.y),t.fill(),t.closePath()},t.linePolygon=function(t,n,a,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.moveTo(t+Math.cos(i)*a,n+Math.sin(i)*a);for(var o=1;o<=e;o++)this.lineTo(t+Math.cos(i+o/e*Math.PI*2)*a,n+Math.sin(i+o/e*Math.PI*2)*a)},t.strokePolygon=function(t,n,a,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,n,a,e,i),this.stroke(),this.closePath()},t.fillPolygon=function(t,n,a,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,n,a,e,i),this.fill(),this.closePath()},t.lineStar=function(t,n,a,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.moveTo(t+Math.cos(o)*e,n+Math.sin(o)*e);for(var r=1;r<=i;r++){var s=o+(r-.5)/i*Math.PI*2,h=mathTools.degToXY(s,a);this.lineTo(t+h.x,n+h.y),s=o+r/i*Math.PI*2,h=mathTools.degToXY(s,e),this.lineTo(t+h.x,n+h.y)}},t.strokeStar=function(t,n,a,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,n,a,e,i,o),this.stroke(),this.closePath()},t.fillStar=function(t,n,a,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,n,a,e,i,o),this.fill(),this.closePath()}}