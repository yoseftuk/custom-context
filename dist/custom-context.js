"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var a=0,i=new Array(t.length);a<t.length;a++)i[a]=t[a];return i}}function initAnimations(t){t.isAnimated=!1,t.lastLoop=(new Date).getTime(),t.animationCallback=function(){},t.cancelAnimation=function(){this.isAnimated=!1},t.startAnimation=function(a){this.isAnimated=!0,this.animationCallback=a,t.lastLoop=(new Date).getTime(),this.loop()},t.loop=function(){if(this.isAnimated){var t=this.lastLoop;this.lastLoop=(new Date).getTime();var a=this.lastLoop-t;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.animationCallback(a,this),requestAnimationFrame(this.loop.bind(this))}}}function initFunctionDrawing(t){t.drawFunction=function(a){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.xFrom||0,e=void 0===i.xTo?t.canvas.width:i.xTo,o=i.yFrom||0,h=void 0===i.yTo?t.canvas.height:i.yTo,r=i.fill,s=i.lineWidth||1;this.beginPath();for(var c=0;c<this.canvas.width;c++){var l=n+c/this.canvas.width*(e-n),d=(a(l)-o)/(h-o)*this.canvas.height;this.fillRect(c,this.canvas.height-d,1,r?d:s)}this.closePath()},t.drawRadialFunction=function(a){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.xFrom||0,e=void 0===i.xTo?t.canvas.width/2:i.xTo,o=i.yFrom||0,h=void 0===i.yTo?t.canvas.height/2:i.yTo,r=i.fill,s=i.lineWidth||1,c=void 0===i.centerX?t.canvas.width/2:i.centerX,l=void 0===i.centerY?t.canvas.height/2:i.centerY;this.beginPath();for(var d=0;d<=2*Math.PI;d+=.01){var g=(a(d)-n)/(e-n)*Math.cos(d)*this.canvas.width/2+c,v=(a(d)-o)/(h-o)*Math.sin(d)*this.canvas.height/2+l;0===d?this.moveTo(g,v):this.lineTo(g,v)}t.lineWidth=s,r?this.fill():this.stroke(),this.closePath()}}function initHotSpot(t){t.addHotSpot=function(t,a){return new HotSpot(this,t,a)}}function HotSpot(t,a,i){var n=this;this.ctx=t,this.options=i,this.listeners={},this.isIn=function(t,a){return!1};var e=function(t,a){return{X:t.offsetX*a.canvas.width/a.canvas.offsetWidth,Y:t.offsetY*a.canvas.height/a.canvas.offsetHeight}};switch(a){case"rect":this.isIn=function(t,a){var i=n.options,e=i.x,o=i.y,h=i.width,r=i.height,s=i.rotate,c=e+h/2,l=o+r/2,d=mathTools.rotation(t-c,a-l,-(s||0));return d.x+=c,d.y+=l,d.x>e&&d.x<e+h&&d.y>o&&d.y<o+r};break;case"circle":this.isIn=function(t,a){var i=n.options,e=i.x,o=i.y,h=i.radius;return mathTools.distance(e,o,t,a)<h};break;case"polygon":this.isIn=function(t,a){var i=n.options,e=i.cx,o=i.cy,h=i.radius,r=i.vertexCount,s=i.rotate,c=(2.5*Math.PI-(s||0)-Math.atan2(t-e,a-o))%(2*Math.PI),l=Math.floor(c*r/Math.PI/2),d=2*Math.PI/r,g=mathTools.degToXY(d*l+(s||0),h),v=mathTools.degToXY(d*(l+1)+(s||0),h),u=mathTools.lineFunc(g.x+e,v.x+e,g.y+o,v.y+o),m=mathTools.lineFunc(e,t,o,a),f=m.m,w=m.a,I=(u.a-w)/(f-u.m),x=f*I+w;return mathTools.distance(e,o,t,a)<mathTools.distance(e,o,I,x)}}this.ctx.canvas.addEventListener("click",(function(t){var a=e(t,n.ctx),i=a.X,o=a.Y;n.listeners.click&&n.isIn(i,o)&&n.listeners.click(t)})),this.ctx.canvas.addEventListener("mousemove",(function(t){var a=e(t,n.ctx),i=a.X,o=a.Y;n.isIn(i,o)?(n.ctx.canvas.style.cursor="pointer",!1!==n.options.pointOnHover&&n.listeners.mouseenter&&n.listeners.mouseenter(t)):(n.ctx.canvas.style.cursor="",!1!==n.options.pointOnHover&&n.listeners.mouseleave&&n.listeners.mouseleave(t))})),this.remove=function(){return this.listeners={},this},this.on=function(t,a){var i=this;this.listeners[t]=a;this.ctx.canvas.addEventListener(t,(function(t){var n=e(t,i.ctx),o=n.X,h=n.Y;i.isIn(o,h)&&a(t)}));return this}}function initImageDrawing(t){t.loadImage=function(t){return new Promise((function(a,i){var n=new Image;n.src=t,n.onload=function(){n.onload=null,a(n)},n.onerror=function(){i("field to load resource")}}))},t.drawImageUrl=function(t,a,i,n,e,o,h,r,s){var c=this;return new Promise((function(l,d){c.loadImage(t).then((function(t){o?c.drawImage(t,a,i,n,e,o,h,r,s):n?c.drawImage(t,a,i,n,e):c.drawImage(t,a,i),l(t)})).catch((function(t){d(t)}))}))},t.drawCircleImage=function(t,a,i,n){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.width,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:t.height;this.save(),this.beginPath(),this.arc(a+n,i+n,n,0,2*Math.PI,!0),this.closePath(),this.clip(),this.drawImage(t,e,o,h,r,a,i,2*n,2*n),this.restore()},t.drawCircleImageUrl=function(t,a,i,n){var e=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;this.loadImage(t).then((function(t){e.drawCircleImage(t,a,i,n,o,h,r||t.width,s||t.height)})).catch((function(){}))},t.loadImageCover=function(t,a,i){var n=this;return new Promise((function(e,o){n.loadImage(t).then((function(t){var h=document.createElement("canvas");h.width=a,h.height=i,h.getCustomContext().drawImageCover(t,0,0,a,i),n.loadImage(h.toDataURL()).then(e).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageCover=function(t,a,i,n,e){var o=t.width/t.height,h=n/e;o>h?this.drawImage(t,(t.width-t.width*h/o)/2,0,t.width*h/o,t.height,a,i,n,e):this.drawImage(t,0,(t.height-t.height*o/h)/2,t.width,t.height*o/h,a,i,n,e)},t.drawImageCoverUrl=function(t,a,i,n,e){var o=this;return this.loadImage(t).then((function(t){o.drawImageCover(t,a,i,n,e)}))},t.loadImageContain=function(t,a,i){var n=this;return new Promise((function(e,o){n.loadImage(t).then((function(t){var h=document.createElement("canvas");h.width=a,h.height=i,h.getCustomContext().drawImageContain(t,0,0,a,i),n.loadImage(h.toDataURL()).then(e).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageContain=function(t,a,i,n,e){var o=t.width/t.height,h=n/e;o>h?this.drawImage(t,a,i+(e-e*h/o)/2,n,e*h/o):this.drawImage(t,a+(n-n*o/h)/2,i,n*o/h,e)},t.drawImageContainUrl=function(t,a,i,n,e){var o=this;return this.loadImage(t).then((function(t){o.drawImageContain(t,a,i,n,e)}))},t.drawRotatesImage=function(t,a){arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.canvas.width,arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.canvas.height},t.straighten=function(t,a){a=(a=(+a+Math.pow(360,2))%360)/180*Math.PI;var i=t.width,n=t.height,e=mathTools.rotation(-i/2,-n/2,a),o=mathTools.rotation(i/2,-n/2,a),h=(mathTools.rotation(-i/2,n/2,a),mathTools.rotation(i/2,n/2,a),mathTools.lineFunc(e.x,o.x,e.y,o.y)),r=h.m,s=h.a,c=n/i,l=s/((c=a%Math.PI<Math.PI/2?-n/i:n/i)-r),d=l*c,g=2*mathTools.distance(l,d),v=Math.atan(n/i),u=g*Math.cos(v),m=g*Math.sin(v),f=document.createElement("canvas"),w=f.getCustomContext();return f.width=i,f.height=n,w.save(),w.beginPath(),w.rect(i/2-u/2,n/2-m/2,u,m),w.clip(),w.translate(i/2,n/2),w.rotate(a),w.drawImage(t,0,0,i,n,-i/2,-n/2,i,n),w.closePath(),w.restore(),new Promise((function(t,a){w.loadImage(f.toDataURL()).then((function(a){w.drawImage(a,i/2-u/2,n/2-m/2,u,m,0,0,f.width,f.height),t(f.toDataURL())})).catch((function(t){return a(t)}))}))},t.straightenUrl=function(t,a){var i=this;return this.loadImage(t).then((function(t){return i.straighten(t,a)}))},t.opacityMask=function(t){var a=document.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height;var i=a.getCustomContext();i.drawImage(t,0,0,a.width,a.height);for(var n=i.getAllImageData().data,e=this.getAllImageData(),o=0;o<n.length;o+=4)e.data[o+3]=n[o+3];this.putImageData(e,0,0)},t.opacityMaskUrl=function(t){var a=this;this.loadImage(t).then((function(t){a.opacityMask(t)}))}}function ImageFilter(t,a){var i=this;this.ctx=t,this.img=a,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=a.width,this.mCanvas.height=a.height,this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.drawImage(a,0,0),this.imagedata=this.mCtx.getImageData(0,0,this.mCanvas.width,this.mCanvas.height),this.data=this.imagedata.data,this.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.img.width,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.img.height,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:i.ctx.canvas.width,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.ctx.canvas.height;i.ctx.drawImageUrl(i.url(),o,h,r,s,t,a,n,e)},this.url=function(){return i.mCtx.putImageData(i.imagedata,0,0),i.mCanvas.toDataURL()},this.grayscale=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<i.data.length;a+=4){var n=(i.data[a]+i.data[a+1]+i.data[a+2])/3;i.data[a]+=(n-i.data[a])*t,i.data[a+1]+=(n-i.data[a+1])*t,i.data[a+2]+=(n-i.data[a+2])*t}return i},this.contrast=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,a=0;a<i.data.length;a+=4)for(var n=0;n<3;n++)i.data[a+n]=2*t*(i.data[a+n]-128)+128;return i},this.mat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75;t/=3;for(var a=0;a<i.data.length;a+=4)for(var n=0;n<3;n++)i.data[a+n]>=128?i.data[a+n]+=t*(255-i.data[a+n]):i.data[a+n]*=1-t;return i},this.brightness=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.25,a=0;a<i.data.length;a+=4)for(var n=0;n<3;n++)i.data[a+n]*=t;return i},this.invert=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<i.data.length;a+=4)for(var n=0;n<3;n++)i.data[a+n]+=(255-2*i.data[a+n])*t;return i},this.r=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<i.data.length;a+=4)i.data[a]*=t;return i},this.g=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=1;a<i.data.length;a+=4)i.data[a]*=t;return i},this.b=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=2;a<i.data.length;a+=4)i.data[a]*=t;return i},this.rgb=function(t,a,n){for(var e=0;e<i.data.length;e+=4)i.data[e]*=t,i.data[e+1]*=a,i.data[e+2]*=n;return i}}HTMLCanvasElement.prototype.getCustomContext=function(){var t=this.getContext("2d");return t?(initImageDrawing(t),initFunctionDrawing(t),initShapesDrawing(t),initAnimations(t),initHotSpot(t),t.getAllImageData=function(){return this.getImageData(0,0,this.canvas.width,this.canvas.height)},t.clearAllRect=function(){return this.clearRect(0,0,this.canvas.width,this.canvas.height)},t.flipVertical=function(){var t=this;this.replacePixelsBy((function(a,i){return{newRow:t.canvas.height-a,newCol:i}}))},t.flipHorizontal=function(){var t=this;this.replacePixelsBy((function(a,i){return{newRow:a,newCol:t.canvas.width-i}}))},t.getIndexPosition=function(t){var a=t%this.canvas.width;return{row:(t-a)/this.canvas.width,col:a}},t.replacePixelsBy=function(t){for(var a=this.getAllImageData(),i=_toConsumableArray(a.data),n=0;n<this.canvas.width*this.canvas.height;n++)for(var e=this.getIndexPosition(n),o=t(e.row,e.col),h=o.newRow,r=o.newCol,s=this.canvas.width*h*4+4*r,c=4*n,l=0;l<4;l++)a.data[s+l]=i[c+l];this.putImageData(a,0,0)},t.circleLight=function(t,a,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,e=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],this.getAllImageData()),o=e.data,h=t-i;h<t+i;h++)for(var r=a-i;r<a+i;r++)for(var s=0;s<4;s++)o[4*h+r*this.canvas.width*4+s]*=1+(i-mathTools.distance(h,r,t,a)>=0?(1-mathTools.distance(h,r,t,a)/i)*n:0);this.putImageData(e,0,0)},t.fillRectRotated=function(a,i,n,e,o){t.beginPath(),t.translate(a+n/2,i+e/2),t.rotate(o),t.fillRect(-n/2,-e/2,n,e),t.closePath()},t.filterImage=function(t){return new ImageFilter(this,t)},t):null};var mathTools={distance:function(t,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-a,2))},rotation:function(t,a,i){return{x:t*Math.cos(i)-a*Math.sin(i),y:t*Math.sin(i)+a*Math.cos(i)}},lineFunc:function(t,a,i,n){var e=(n-i)/(a-t);return{m:e,a:n-a*e}},degToXY:function(t,a){return{x:Math.cos(t)*a,y:Math.sin(t)*a}}};function initShapesDrawing(t){t.drawArrow=function(a,i,n,e){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:6;this.beginPath(),this.moveTo(a,i),this.lineTo(n,e),this.stroke(),this.closePath();var r=function(){return n-a},s=function(){return e-i},c=Math.sqrt(Math.pow(r(),2)+Math.pow(s(),2)),l={x:n,y:e},d={x:n-o/c*r(),y:e-o/c*s()},g=s()/r(),v=0;g===1/0?g=0:v=-1/g;var u=h/Math.sqrt(1+Math.pow(v,2)),m={x:d.x+u,y:d.y+v*u},f={x:d.x-u,y:d.y-v*u};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(m.x,m.y),t.lineTo(f.x,f.y),t.lineTo(l.x,l.y),t.fill(),t.closePath()},t.linePolygon=function(t,a,i,n){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.moveTo(t+Math.cos(e)*i,a+Math.sin(e)*i);for(var o=1;o<=n;o++)this.lineTo(t+Math.cos(e+o/n*Math.PI*2)*i,a+Math.sin(e+o/n*Math.PI*2)*i)},t.strokePolygon=function(t,a,i,n){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,i,n,e),this.stroke(),this.closePath()},t.fillPolygon=function(t,a,i,n){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,i,n,e),this.fill(),this.closePath()},t.lineStar=function(t,a,i,n,e){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.moveTo(t+Math.cos(o)*n,a+Math.sin(o)*n);for(var h=1;h<=e;h++){var r=o+(h-.5)/e,s=mathTools.degToXY(r,i);this.lineTo(t+s.x,a+s.y),r=o+h/e,s=mathTools.degToXY(r,n),this.lineTo(t+s.x,a+s.y)}},t.strokeStar=function(t,a,i,n,e){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,a,i,n,e,o),this.stroke(),this.closePath()},t.fillStar=function(t,a,i,n,e){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.beginPath(),this.lineStar(t,a,i,n,e,o),this.fill(),this.closePath()}}