"use strict";function ImageFilter(t,a){var n=this;this.ctx=t,this.img=a,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=a.width,this.mCanvas.height=a.height,this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.drawImage(a,0,0),this.imagedata=this.mCtx.getImageData(0,0,this.mCanvas.width,this.mCanvas.height),this.data=this.imagedata.data,this.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.img.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.img.height,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.ctx.canvas.width,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n.ctx.canvas.height;n.ctx.drawImageUrl(n.url(),h,o,r,d,t,a,e,i)},this.url=function(){return n.mCtx.putImageData(n.imagedata,0,0),n.mCanvas.toDataURL()},this.grayscale=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<n.data.length;a+=4){var e=(n.data[a]+n.data[a+1]+n.data[a+2])/3;n.data[a]+=(e-n.data[a])*t,n.data[a+1]+=(e-n.data[a+1])*t,n.data[a+2]+=(e-n.data[a+2])*t}return n},this.contrast=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,a=0;a<n.data.length;a+=4)for(var e=0;e<3;e++)n.data[a+e]=2*t*(n.data[a+e]-128)+128;return n},this.mat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75;t/=3;for(var a=0;a<n.data.length;a+=4)for(var e=0;e<3;e++)n.data[a+e]>=128?n.data[a+e]+=t*(255-n.data[a+e]):n.data[a+e]*=1-t;return n}}HTMLCanvasElement.prototype.getCustomContext=function(){var t=this.getContext("2d");return t?(t.drawArrow=function(a,n,e,i){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:6;this.beginPath(),this.moveTo(a,n),this.lineTo(e,i),this.stroke(),this.closePath();var r=function(){return e-a},d=function(){return i-n},g=Math.sqrt(Math.pow(r(),2)+Math.pow(d(),2)),s={x:e,y:i},l={x:e-h/g*r(),y:i-h/g*d()},c=d()/r(),v=0;c===1/0?c=0:v=-1/c;var m=o/Math.sqrt(1+Math.pow(v,2)),u={x:l.x+m,y:l.y+v*m},f={x:l.x-m,y:l.y-v*m};t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(u.x,u.y),t.lineTo(f.x,f.y),t.lineTo(s.x,s.y),t.fill(),t.closePath()},t.loadImage=function(t){return new Promise((function(a,n){var e=new Image;e.src=t,e.onload=function(){e.onload=null,a(e)},e.onerror=function(){n("field to load resource")}}))},t.drawImageUrl=function(t,a,n,e,i,h,o,r,d){var g=this;this.loadImage(t).then((function(t){h?g.drawImage(t,a,n,e,i,h,o,r,d):e?g.drawImage(t,a,n,e,i):g.drawImage(t,a,n)})).catch((function(){}))},t.drawCircleImage=function(t,a,n,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.width,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:t.height;this.save(),this.beginPath(),this.arc(a+e,n+e,e,0,2*Math.PI,!0),this.closePath(),this.clip(),this.drawImage(t,i,h,o,r,a,n,2*e,2*e),this.restore()},t.drawCircleImageUrl=function(t,a,n,e){var i=this,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0;this.loadImage(t).then((function(t){i.drawCircleImage(t,a,n,e,h,o,r||t.width,d||t.height)})).catch((function(){}))},t.loadImageCover=function(t,a,n){var e=this;return new Promise((function(i,h){e.loadImage(t).then((function(t){var o=document.createElement("canvas");o.width=a,o.height=n,o.getCustomContext().drawImageCover(t,0,0,a,n),e.loadImage(o.toDataURL()).then(i).catch(h)})).catch((function(t){return console.error(t)}))}))},t.drawImageCover=function(t,a,n,e,i){var h=t.width/t.height,o=e/i;h>o?this.drawImage(t,(t.width-t.width*o/h)/2,0,t.width*o/h,t.height,a,n,e,i):this.drawImage(t,0,(t.height-t.height*h/o)/2,t.width,t.height*h/o,a,n,e,i)},t.drawImageCoverUrl=function(t,a,n,e,i){var h=this;return this.loadImage(t).then((function(t){h.drawImageCover(t,a,n,e,i)}))},t.loadImageContain=function(t,a,n){var e=this;return new Promise((function(i,h){e.loadImage(t).then((function(t){var o=document.createElement("canvas");o.width=a,o.height=n,o.getCustomContext().drawImageContain(t,0,0,a,n),e.loadImage(o.toDataURL()).then(i).catch(h)})).catch((function(t){return console.error(t)}))}))},t.drawImageContain=function(t,a,n,e,i){var h=t.width/t.height,o=e/i;h>o?this.drawImage(t,a,n+(i-i*o/h)/2,e,i*o/h):this.drawImage(t,a+(e-e*h/o)/2,n,e*h/o,i)},t.drawImageContainUrl=function(t,a,n,e,i){var h=this;return this.loadImage(t).then((function(t){h.drawImageContain(t,a,n,e,i)}))},t.linePolygon=function(t,a,n,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.moveTo(t+Math.cos(i)*n,a+Math.sin(i)*n);for(var h=1;h<=e;h++)this.lineTo(t+Math.cos(i+h/e*Math.PI*2)*n,a+Math.sin(i+h/e*Math.PI*2)*n)},t.strokePolygon=function(t,a,n,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,n,e,i),this.stroke(),this.closePath()},t.fillPolygon=function(t,a,n,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,n,e,i),this.fill(),this.closePath()},t.filterImage=function(t){return new ImageFilter(this,t)},t):null};