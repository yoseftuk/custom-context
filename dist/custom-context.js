"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var a=0,n=new Array(t.length);a<t.length;a++)n[a]=t[a];return n}}function initAnimations(t){t.isAnimated=!1,t.lastLoop=(new Date).getTime(),t.animationCallback=function(){},t.cancelAnimation=function(){this.isAnimated=!1},t.startAnimation=function(a){this.isAnimated=!0,this.animationCallback=a,t.lastLoop=(new Date).getTime(),this.loop()},t.loop=function(){if(this.isAnimated){var t=this.lastLoop;this.lastLoop=(new Date).getTime();var a=this.lastLoop-t;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.animationCallback(a,this),requestAnimationFrame(this.loop.bind(this))}}}function initFunctionDrawing(t){t.drawFunction=function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.xFrom||0,e=void 0===n.xTo?t.canvas.width:n.xTo,o=n.yFrom||0,h=void 0===n.yTo?t.canvas.height:n.yTo,r=n.fill,s=n.lineWidth||1;this.beginPath();for(var c=0;c<this.canvas.width;c++){var l=i+c/this.canvas.width*(e-i),d=(a(l)-o)/(h-o)*this.canvas.height;this.fillRect(c,this.canvas.height-d,1,r?d:s)}this.closePath()},t.drawRadialFunction=function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.xFrom||0,e=void 0===n.xTo?t.canvas.width/2:n.xTo,o=n.yFrom||0,h=void 0===n.yTo?t.canvas.height/2:n.yTo,r=n.fill,s=n.lineWidth||1,c=void 0===n.centerX?t.canvas.width/2:n.centerX,l=void 0===n.centerY?t.canvas.height/2:n.centerY;this.beginPath();for(var d=0;d<=2*Math.PI;d+=.01){var g=(a(d)-i)/(e-i)*Math.cos(d)*this.canvas.width/2+c,v=(a(d)-o)/(h-o)*Math.sin(d)*this.canvas.height/2+l;0===d?this.moveTo(g,v):this.lineTo(g,v)}t.lineWidth=s,r?this.fill():this.stroke(),this.closePath()}}function initHotSpot(t){t.addHotSpot=function(t,a){return new HotSpot(this,t,a)}}function HotSpot(t,a,n){switch(a){case"polygon":this._listener=t.canvas.addEventListener("click",(function(a){var i=a.x/t.canvas.offsetWidth*t.canvas.width,e=a.y/t.canvas.offsetHeight*t.canvas.height,o=(n.vertexCount>=3&&n.vertexCount,void 0!==n.rotate&&n.rotate,n.cx),h=n.cy,r=i>o?Math.atan((h-e)/(o-i)):-Math.atan((h-e)/(o-i));console.log(r)}))}}function initImageDrawing(t){t.loadImage=function(t){return new Promise((function(a,n){var i=new Image;i.src=t,i.onload=function(){i.onload=null,a(i)},i.onerror=function(){n("field to load resource")}}))},t.drawImageUrl=function(t,a,n,i,e,o,h,r,s){var c=this;return new Promise((function(l,d){c.loadImage(t).then((function(t){o?c.drawImage(t,a,n,i,e,o,h,r,s):i?c.drawImage(t,a,n,i,e):c.drawImage(t,a,n),l(t)})).catch((function(t){d(t)}))}))},t.drawCircleImage=function(t,a,n,i){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.width,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:t.height;this.save(),this.beginPath(),this.arc(a+i,n+i,i,0,2*Math.PI,!0),this.closePath(),this.clip(),this.drawImage(t,e,o,h,r,a,n,2*i,2*i),this.restore()},t.drawCircleImageUrl=function(t,a,n,i){var e=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;this.loadImage(t).then((function(t){e.drawCircleImage(t,a,n,i,o,h,r||t.width,s||t.height)})).catch((function(){}))},t.loadImageCover=function(t,a,n){var i=this;return new Promise((function(e,o){i.loadImage(t).then((function(t){var h=document.createElement("canvas");h.width=a,h.height=n,h.getCustomContext().drawImageCover(t,0,0,a,n),i.loadImage(h.toDataURL()).then(e).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageCover=function(t,a,n,i,e){var o=t.width/t.height,h=i/e;o>h?this.drawImage(t,(t.width-t.width*h/o)/2,0,t.width*h/o,t.height,a,n,i,e):this.drawImage(t,0,(t.height-t.height*o/h)/2,t.width,t.height*o/h,a,n,i,e)},t.drawImageCoverUrl=function(t,a,n,i,e){var o=this;return this.loadImage(t).then((function(t){o.drawImageCover(t,a,n,i,e)}))},t.loadImageContain=function(t,a,n){var i=this;return new Promise((function(e,o){i.loadImage(t).then((function(t){var h=document.createElement("canvas");h.width=a,h.height=n,h.getCustomContext().drawImageContain(t,0,0,a,n),i.loadImage(h.toDataURL()).then(e).catch(o)})).catch((function(t){return console.error(t)}))}))},t.drawImageContain=function(t,a,n,i,e){var o=t.width/t.height,h=i/e;o>h?this.drawImage(t,a,n+(e-e*h/o)/2,i,e*h/o):this.drawImage(t,a+(i-i*o/h)/2,n,i*o/h,e)},t.drawImageContainUrl=function(t,a,n,i,e){var o=this;return this.loadImage(t).then((function(t){o.drawImageContain(t,a,n,i,e)}))},t.drawRotatesImage=function(t,a){arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.canvas.width,arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.canvas.height},t.straighten=function(t,a){a=(a=(+a+Math.pow(360,2))%360)/180*Math.PI;var n=t.width,i=t.height,e=mathTools.rotation(-n/2,-i/2,a),o=mathTools.rotation(n/2,-i/2,a);mathTools.rotation(-n/2,i/2,a),mathTools.rotation(n/2,i/2,a);console.log(e,o);var h=mathTools.lineFunc(e.x,o.x,e.y,o.y),r=h.m,s=h.a;console.log("line",r,s);var c=i/n,l=s/((c=a%Math.PI<Math.PI/2?-i/n:i/n)-r),d=l*c,g=2*mathTools.distance(l,d);console.log("disptance",l,d,g);var v=Math.atan(i/n),u=g*Math.cos(v),m=g*Math.sin(v);console.log("params",n,i,u,m);var f=document.createElement("canvas"),w=f.getCustomContext();return f.width=n,f.height=i,w.save(),w.beginPath(),w.rect(n/2-u/2,i/2-m/2,u,m),w.clip(),w.translate(n/2,i/2),w.rotate(a),w.drawImage(t,0,0,n,i,-n/2,-i/2,n,i),w.closePath(),w.restore(),new Promise((function(t,a){w.loadImage(f.toDataURL()).then((function(a){w.drawImage(a,n/2-u/2,i/2-m/2,u,m,0,0,f.width,f.height),t(f.toDataURL())})).catch((function(t){return a(t)}))}))},t.straightenUrl=function(t,a){var n=this;return this.loadImage(t).then((function(t){return n.straighten(t,a)}))},t.opacityMask=function(t){var a=document.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height;var n=a.getCustomContext();n.drawImage(t,0,0,a.width,a.height);for(var i=n.getAllImageData().data,e=this.getAllImageData(),o=0;o<i.length;o+=4)e.data[o+3]=i[o+3];this.putImageData(e,0,0)},t.opacityMaskUrl=function(t){var a=this;this.loadImage(t).then((function(t){a.opacityMask(t)}))}}function ImageFilter(t,a){var n=this;this.ctx=t,this.img=a,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=a.width,this.mCanvas.height=a.height,this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.drawImage(a,0,0),this.imagedata=this.mCtx.getImageData(0,0,this.mCanvas.width,this.mCanvas.height),this.data=this.imagedata.data,this.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.img.width,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.img.height,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.ctx.canvas.width,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n.ctx.canvas.height;n.ctx.drawImageUrl(n.url(),o,h,r,s,t,a,i,e)},this.url=function(){return n.mCtx.putImageData(n.imagedata,0,0),n.mCanvas.toDataURL()},this.grayscale=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<n.data.length;a+=4){var i=(n.data[a]+n.data[a+1]+n.data[a+2])/3;n.data[a]+=(i-n.data[a])*t,n.data[a+1]+=(i-n.data[a+1])*t,n.data[a+2]+=(i-n.data[a+2])*t}return n},this.contrast=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,a=0;a<n.data.length;a+=4)for(var i=0;i<3;i++)n.data[a+i]=2*t*(n.data[a+i]-128)+128;return n},this.mat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75;t/=3;for(var a=0;a<n.data.length;a+=4)for(var i=0;i<3;i++)n.data[a+i]>=128?n.data[a+i]+=t*(255-n.data[a+i]):n.data[a+i]*=1-t;return n},this.brightness=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.25,a=0;a<n.data.length;a+=4)for(var i=0;i<3;i++)n.data[a+i]*=t;return n},this.invert=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<n.data.length;a+=4)for(var i=0;i<3;i++)n.data[a+i]+=(255-2*n.data[a+i])*t;return n},this.r=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=0;a<n.data.length;a+=4)n.data[a]*=t;return n},this.g=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=1;a<n.data.length;a+=4)n.data[a]*=t;return n},this.b=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=2;a<n.data.length;a+=4)n.data[a]*=t;return n},this.rgb=function(t,a,i){for(var e=0;e<n.data.length;e+=4)n.data[e]*=t,n.data[e+1]*=a,n.data[e+2]*=i;return n}}HTMLCanvasElement.prototype.getCustomContext=function(){var t=this.getContext("2d");return t?(initImageDrawing(t),initFunctionDrawing(t),initShapesDrawing(t),initAnimations(t),t.getAllImageData=function(){return this.getImageData(0,0,this.canvas.width,this.canvas.height)},t.clearAllRect=function(){return this.clearRect(0,0,this.canvas.width,this.canvas.height)},t.flipVertical=function(){var t=this;this.replacePixelsBy((function(a,n){return{newRow:t.canvas.height-a,newCol:n}}))},t.flipHorizontal=function(){var t=this;this.replacePixelsBy((function(a,n){return{newRow:a,newCol:t.canvas.width-n}}))},t.getIndexPosition=function(t){var a=t%this.canvas.width;return{row:(t-a)/this.canvas.width,col:a}},t.replacePixelsBy=function(t){for(var a=this.getAllImageData(),n=_toConsumableArray(a.data),i=0;i<this.canvas.width*this.canvas.height;i++)for(var e=this.getIndexPosition(i),o=t(e.row,e.col),h=o.newRow,r=o.newCol,s=this.canvas.width*h*4+4*r,c=4*i,l=0;l<4;l++)a.data[s+l]=n[c+l];this.putImageData(a,0,0)},t.circleLight=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2]},t.filterImage=function(t){return new ImageFilter(this,t)},t):null};var mathTools={distance:function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-a,2))},rotation:function(t,a,n){return{x:t*Math.cos(n)-a*Math.sin(n),y:t*Math.sin(n)+a*Math.cos(n)}},lineFunc:function(t,a,n,i){var e=(i-n)/(a-t);return{m:e,a:i-a*e}}};function initShapesDrawing(t){t.drawArrow=function(a,n,i,e){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:6;this.beginPath(),this.moveTo(a,n),this.lineTo(i,e),this.stroke(),this.closePath();var r=function(){return i-a},s=function(){return e-n},c=Math.sqrt(Math.pow(r(),2)+Math.pow(s(),2)),l={x:i,y:e},d={x:i-o/c*r(),y:e-o/c*s()},g=s()/r(),v=0;g===1/0?g=0:v=-1/g;var u=h/Math.sqrt(1+Math.pow(v,2)),m={x:d.x+u,y:d.y+v*u},f={x:d.x-u,y:d.y-v*u};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(m.x,m.y),t.lineTo(f.x,f.y),t.lineTo(l.x,l.y),t.fill(),t.closePath()},t.linePolygon=function(t,a,n,i){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.moveTo(t+Math.cos(e)*n,a+Math.sin(e)*n);for(var o=1;o<=i;o++)this.lineTo(t+Math.cos(e+o/i*Math.PI*2)*n,a+Math.sin(e+o/i*Math.PI*2)*n)},t.strokePolygon=function(t,a,n,i){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,n,i,e),this.stroke(),this.closePath()},t.fillPolygon=function(t,a,n,i){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.beginPath(),this.linePolygon(t,a,n,i,e),this.fill(),this.closePath()}}